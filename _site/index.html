<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Nothing About Data</title>
    <meta name="description" content="This blog power by Github and Jekyll.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://dada889.github.io/">
</head>


  <body>

    <header class="site-header">


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
                  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
                          });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <div class="wrapper">

    <a class="site-title" href="/">Nothing About Data</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
          <a class="page-link" href="/Archive">Archive</a>
          <a class="page-link" href="/Categories">Categories</a>
	  <a class="page-link" href="/about">About</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <blockquote>
  <p>Talk is cheap. Show me the code. —– Linus Torvalds</p>
</blockquote>

<div class="home">
<!--
  <h1 class="page-heading">My Articles</h1>
-->

  <ul class="post-list">
    
      <li>
        <span class="post-meta">Dec 16, 2014</span>

        <h2>
          <a class="post-link" href="/2014/12/Support-Vector-Machine.html">Support-Vector-Machine</a>
        </h2>
	<hr style="color:#EEEEFF" />
	<p><h2 id="what-is-support-vecor-machine">What is Support vecor machine</h2>
<p>According to <a href="http://en.wikipedia.org/wiki/Support_vector_machine">wikipedia</a>, support vector machines (SVMs, also support vector networks) are supervised learning models with associated learning algorithms that analyze data and recognize patterns, used for classification and regression analysis. More formally, a support vector machine constructs a hyperplane or set of hyperplanes in a high- or infinite-dimensional space, which can be used for classification, regression, or other tasks.</p>

<p>SVMs were introduced by Vapnik in 1992, they often provide significantly better classfication performance than other machine learning algorithms on reasonably sized datasets.</p>

<h2 id="learning-model">Learning model</h2>

<p>$X$ is the matrix of training data with $n$ rows and $d$ columns, $x_1,…,x_n \in \mathbb{R}^d$. Suppose given a dot product space $\mathcal{H}$, and $h(x)$ is a transformed feature vectors. We will have kernal data $h(x_1),….,h(x_n) \in \mathcal{H}$. Any hyperplane in $\mathcal{H}$ can be written as:</p>

<script type="math/tex; mode=display">\{h(x) \in \mathcal{H} | w \cdot h(x) - b = 0 \}, w \in \mathcal{H}, b \in \mathbb{R}</script>

<p>Given a pair of ($w,b$), we have decision function for two class:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{aligned}
        f(x) & =  w \cdot h(x) - b   &     & \\
 for:  & f(x_i) \geq 1 - \xi_i          & \hat{y_i} & = 1 \\
       & f(x_i) \leq -(1 - \xi_i)          & \hat{y_i} & = -1 \\
\end{aligned} %]]></script>

<p>$\xi_i$ is non-negative slack variable. In order to find the hyperplane that creates the biggest margin between the two class $1$ and $-1$, we will keep $| w|$ as small as possible. We will choose $w$ and $b$ that minimize $| w|$ in condition of $y_if(x_i)\geq 1-\xi_i$ and $\xi_i\geq 0$ for all $i$. The optimization problem can be formulated with penalty term:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{aligned}
 \underset{w,b}{\text{minimize}} & \frac{1}{2}\| w\|^2 +C\sum\limits_{i=1}^n\xi_i  &\\
 \text{subject to:}                     & y_if(x_i) + \xi_i -1 > 0                  &\forall i \\
                                 & \xi_i \geq 0                                    &\forall i
\end{aligned} %]]></script>

<p>$C$ is a constant penalty value, if $C=\infty$, we would have perfect seperating case. This is a constrained optimization problem, and this problem can be solve by Lagrangian. The Lagrange (primal) function with lagrange multiplier $\alpha_i$ and $\mu_i$ are:</p>

<script type="math/tex; mode=display">\mathcal{L}(w,b,\alpha,\mu) = \frac{1}{2}\|w\|^2 + C\sum\limits_{i=1}^n\xi_i - \sum\limits_{i=1}^n\alpha_i[y_if(x_i)+\xi_i -1] - \sum\limits_{i=1}^n\mu_i\xi_i</script>

<p>We can minimize $\mathcal{L}$ with $w$ and $b$ to get the dual problem:</p>

<p>$w$, $\xi_i$ and their Lagrange multipers can be cancel out in the Wolfe dual problem:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{aligned}
 \underset{\alpha}{\text{maximize}} & \mathcal{L}_D(\alpha) =\sum\limits_{i=1}^n\alpha_i -\frac{1}{2}\sum\limits_{i=1}^n \sum\limits_{j=1}^n \alpha_i\alpha_jy_iy_jh(x_i)^Th(x_j) &\\
 \text{subject to:}                     & 0\leq \alpha_i \leq C                  &\forall i \\
                                 & \sum\limits_{i=1}^n \alpha_iy_i = 0                                    &\forall i
\end{aligned} %]]></script>

<p>Which gives the lower bound of $\mathcal{L}$ for any fesible point. We maximize $\mathcal{L}$ subject to $0\leq \alpha\leq C$ and $\sum_{i=1}^n\alpha_i y_i=0$ under the KKT(Karush-Kuhn-Tucker) conditions:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{aligned}
   \alpha_i=0 & \Rightarrow & y_if(x_i)\leq 1 \\
0<\alpha_i<C  & \Rightarrow & y_if(x_i)= 1 \\
   \alpha_i=C & \Rightarrow & y_if(x_i)\geq 1
\end{aligned} %]]></script>

<p>The inner product of $h(x_i)^T$ and $h(x_j)$ can be written $\langle h(x_i),h(x_j)\rangle$. We can use kernel function:</p>

<script type="math/tex; mode=display">K(x_i,x_j)=\langle h(x_i),h(x_j)\rangle</script>

<script type="math/tex; mode=display">\mathcal{L}_D(\alpha) =\sum\limits_{i=1}^n\alpha_i -\frac{1}{2}\sum\limits_{i=1}^n \sum\limits_{j=1}^n \alpha_i\alpha_jy_iy_jK(x_i,x_j)</script>

<p>SMO(Sequential minimal optimization) can be used to maximize $\mathcal{L}_D(\alpha)$, here is the SMO optimization R code for the above optimization problem:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">takeStep</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span><span class="n">y</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span><span class="n">alphas</span><span class="p">,</span><span class="n">eps</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i1</span> <span class="o">==</span> <span class="n">j1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="n">alphai</span> <span class="o">=</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span>
  <span class="n">alphaj</span> <span class="o">=</span> <span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span>
  <span class="n">yi</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span>
  <span class="n">yj</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span>
  <span class="n">ui</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">alphas</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">i1</span><span class="p">,])</span> <span class="o">-</span> <span class="n">b</span>
  <span class="n">uj</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">alphas</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">j1</span><span class="p">,])</span> <span class="o">-</span> <span class="n">b</span>
<span class="c1">#   ui = x[i1,]%*%w - b
#   uj = x[j1,]%*%w - b
</span>  <span class="n">Ei</span> <span class="o">=</span> <span class="n">ui</span> <span class="o">-</span> <span class="n">yi</span>
  <span class="n">Ej</span> <span class="o">=</span> <span class="n">uj</span> <span class="o">-</span> <span class="n">yj</span>
  
  <span class="c1">#compute H and L use old alpha i and j
</span>  <span class="k">if</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="n">j1</span><span class="p">])</span> <span class="p">{</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span> <span class="o">+</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">-</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">+</span> <span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">])</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span> <span class="o">-</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">C</span> <span class="o">+</span> <span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span> <span class="o">-</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">L</span> <span class="o">==</span> <span class="n">H</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="n">eta</span> <span class="o">=</span> <span class="m">2</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span><span class="n">j1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">[</span><span class="n">j1</span><span class="p">,</span><span class="n">j1</span><span class="p">]</span>
  
  
  <span class="c1">#compute new alpha j and i as alphaj and alphai
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">eta</span> <span class="o">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">alphaj</span> <span class="o">=</span> <span class="n">alphaj</span> <span class="o">-</span> <span class="n">yj</span><span class="o">*</span><span class="p">(</span><span class="n">Ei</span> <span class="o">-</span> <span class="n">Ej</span><span class="p">)</span><span class="o">/</span><span class="n">eta</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">alphaj</span> <span class="o">&lt;</span> <span class="n">L</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">alphaj</span> <span class="o">=</span> <span class="n">L</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">alphaj</span> <span class="o">&gt;</span> <span class="n">H</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">alphaj</span> <span class="o">=</span> <span class="n">H</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">Lobj</span> <span class="o">=</span> <span class="n">objfun</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
    <span class="n">Hobj</span> <span class="o">=</span> <span class="n">objfun</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Lobj</span> <span class="o">&gt;</span> <span class="n">Hobj</span> <span class="o">+</span> <span class="n">eps</span><span class="p">){</span>
      <span class="n">alphaj</span> <span class="o">=</span> <span class="n">L</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Lobj</span> <span class="o">&lt;</span> <span class="n">Hobj</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">alphaj</span> <span class="o">=</span> <span class="n">H</span>
    <span class="p">}</span> 
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">alphaj</span> <span class="o">&lt;</span> <span class="m">1e-8</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">alphaj</span> <span class="o">=</span> <span class="m">0</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">alphaj</span> <span class="o">&gt;</span> <span class="n">C</span><span class="m">-1e-8</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">alphaj</span> <span class="o">=</span> <span class="n">C</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">alphaj</span> <span class="o">-</span> <span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="o">*</span><span class="p">(</span><span class="n">alphaj</span><span class="o">+</span><span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="o">+</span><span class="n">eps</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="n">alphai</span> <span class="o">=</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">+</span><span class="n">y</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="o">-</span><span class="n">alphaj</span><span class="p">)</span>
  
  
  <span class="c1">#compute new b and assign
</span>  <span class="n">b1</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">Ei</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">alphai</span><span class="o">-</span><span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">alphaj</span><span class="o">-</span><span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">])</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span><span class="n">j1</span><span class="p">]</span>
  <span class="n">b2</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">Ej</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">alphai</span><span class="o">-</span><span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">i1</span><span class="p">,</span><span class="n">j1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">alphaj</span><span class="o">-</span><span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">])</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">j1</span><span class="p">,</span><span class="n">j1</span><span class="p">]</span>
  <span class="c1"># update b
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">&gt;</span><span class="m">0</span> <span class="o">&amp;</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">C</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">b1</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="o">&gt;</span><span class="m">0</span> <span class="o">&amp;</span> <span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">C</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">b2</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">b1</span><span class="o">+</span><span class="n">b2</span><span class="p">)</span><span class="o">/</span><span class="m">2</span>
  <span class="p">}</span>
  
  <span class="c1">#assign new alpha i and j to alphas
</span>  <span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="n">alphai</span>
  <span class="n">alphas</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="n">alphaj</span>
  
  <span class="c1">#update new weight vector
</span>  <span class="c1">#w = colSums(apply(x, 2, function(z) y*z*alphas))
</span>  <span class="c1">#update error
</span>  <span class="n">ui</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">alphas</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">i1</span><span class="p">,])</span> <span class="o">-</span> <span class="n">b</span>
  <span class="n">uj</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">alphas</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">j1</span><span class="p">,])</span> <span class="o">-</span> <span class="n">b</span>
  <span class="c1">#ui = x[i1,]%*%w - b
</span>  <span class="c1">#uj = x[j1,]%*%w - b
</span>  <span class="n">error</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span>
  <span class="n">error</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="n">uj</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">j1</span><span class="p">]</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>   <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
  <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span>


<span class="n">examineExample</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">y</span><span class="p">,</span>  <span class="n">b</span><span class="p">,</span><span class="n">alphas</span><span class="p">,</span><span class="n">eps</span><span class="p">,</span><span class="n">tol</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">n</span><span class="p">){</span>
  <span class="n">yj</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
  <span class="n">alphaj</span> <span class="o">=</span> <span class="n">alphas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
  <span class="c1">#w = colSums(apply(x, 2, function(z) y*z*alphas))
</span>  <span class="c1">#uj = x[j,]%*%w - b
</span>  <span class="n">uj</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">alphas</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">j</span><span class="p">,])</span>
  <span class="n">Ej</span> <span class="o">=</span> <span class="n">uj</span> <span class="o">-</span> <span class="n">yj</span>
  <span class="n">rj</span> <span class="o">=</span> <span class="n">Ej</span><span class="o">*</span><span class="n">yj</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">rj</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">tol</span> <span class="o">&amp;</span> <span class="n">alphaj</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">rj</span> <span class="o">&gt;</span> <span class="n">tol</span> <span class="o">&amp;</span> <span class="n">alphaj</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1"># first heuristic: choose i that maximize abs(Ei -Ej), only select from suport vector
</span>    <span class="c1">#pos = which(alphas != 0 | alphas != C)
</span>    <span class="n">pos</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="n">alphas</span><span class="o">&gt;</span><span class="n">eps</span> <span class="o">&amp;</span> <span class="n">alphas</span><span class="o">&lt;</span><span class="p">(</span><span class="n">C</span><span class="o">-</span><span class="n">eps</span><span class="p">))</span>
    
    <span class="c1">#rest = which(!(alphas != 0 &amp; alphas != C))
</span>    <span class="n">rest</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">alphas</span><span class="o">&gt;</span><span class="n">eps</span> <span class="o">&amp;</span> <span class="n">alphas</span><span class="o">&lt;</span><span class="p">(</span><span class="n">C</span><span class="o">-</span><span class="n">eps</span><span class="p">)))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">&gt;</span><span class="m">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1"># select i from unbound max abs(Ej - Ei)
</span>      <span class="n">temp</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">alphas</span><span class="p">),</span><span class="m">1</span><span class="p">)</span>
      <span class="n">temp</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">as.numeric</span><span class="p">(</span><span class="n">Ej</span><span class="p">)</span> <span class="o">-</span> <span class="n">error</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
      <span class="n">i1</span> <span class="o">=</span> <span class="n">which.max</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
      <span class="n">heu1</span> <span class="o">=</span> <span class="n">takeStep</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>   <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">heu1</span><span class="o">$</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">#w = heu1$w
</span>        <span class="n">alphas</span> <span class="o">=</span> <span class="n">heu1</span><span class="o">$</span><span class="n">alphas</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">heu1</span><span class="o">$</span><span class="n">error</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">heu1</span><span class="o">$</span><span class="n">b</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="m">+1</span>
        <span class="n">print</span><span class="p">(</span><span class="n">cat</span><span class="p">(</span><span class="s1">'Iteration'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s1">'  heu1'</span><span class="p">,</span><span class="s1">'  b'</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1"># second heuristic: loop over i from all SV
</span>    <span class="k">for</span> <span class="p">(</span><span class="n">i1</span> <span class="k">in</span> <span class="n">sample</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">length</span><span class="p">(</span><span class="n">pos</span><span class="p">)))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">eps</span> <span class="o">&amp;</span> <span class="n">alphas</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="n">C</span><span class="o">-</span><span class="n">eps</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">heu2</span> <span class="o">=</span> <span class="n">takeStep</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">heu2</span><span class="o">$</span><span class="n">val</span><span class="p">){</span>
          <span class="c1">#w = heu2$w
</span>          <span class="n">alphas</span> <span class="o">=</span> <span class="n">heu2</span><span class="o">$</span><span class="n">alphas</span>
          <span class="n">error</span> <span class="o">=</span> <span class="n">heu2</span><span class="o">$</span><span class="n">error</span>
          <span class="n">b</span> <span class="o">=</span> <span class="n">heu2</span><span class="o">$</span><span class="n">b</span>
          <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="m">+1</span>
          <span class="n">print</span><span class="p">(</span><span class="n">cat</span><span class="p">(</span><span class="s1">'Iteration'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s1">'  heu 2'</span><span class="p">,</span><span class="s1">'  b'</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="n">error</span>    <span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
          <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
    <span class="p">}</span>
    <span class="c1"># third heuristic: loop through the rest of data set
</span>    <span class="c1">#rest = which(!(alphas != 0 &amp; alphas != C))
</span>    <span class="n">rest</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">alphas</span><span class="o">&gt;</span><span class="n">eps</span> <span class="o">&amp;</span> <span class="n">alphas</span><span class="o">&lt;</span><span class="p">(</span><span class="n">C</span><span class="o">-</span><span class="n">eps</span><span class="p">)))</span>
    <span class="c1">#print(cat('rest',length(rest)))
</span>    <span class="k">for</span> <span class="p">(</span><span class="n">i1</span> <span class="k">in</span> <span class="n">sample</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span><span class="n">length</span><span class="p">(</span><span class="n">rest</span><span class="p">)))</span> <span class="p">{</span>
      <span class="n">heu3</span> <span class="o">=</span> <span class="n">takeStep</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>    <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">heu3</span><span class="o">$</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">#w = heu3$w
</span>        <span class="n">alphas</span> <span class="o">=</span> <span class="n">heu3</span><span class="o">$</span><span class="n">alphas</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">heu3</span><span class="o">$</span><span class="n">error</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">heu3</span><span class="o">$</span><span class="n">b</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="m">+1</span>
        <span class="n">print</span><span class="p">(</span><span class="n">cat</span><span class="p">(</span><span class="s1">'Iteration'</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s1">'  heu  3'</span><span class="p">,</span><span class="s1">'  b'</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>    <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>    <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">))</span>
<span class="p">}</span>


<span class="n">main</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">tol</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">#w = as.numeric(0)
</span>  <span class="n">n</span><span class="o">=</span><span class="m">0</span>
  <span class="n">alphas</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="m">1</span><span class="p">)</span> <span class="c1">#initial alphas
</span>  <span class="c1">#w = colSums(apply(x, 2, function(z) y*z*alphas)) #in order to initial b
</span>  <span class="n">b</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span> <span class="c1">#initial b
</span>  <span class="n">error</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="m">1</span><span class="p">)</span>
  <span class="n">eps</span> <span class="o">=</span> <span class="m">1e-3</span>
  <span class="n">numChanged</span> <span class="o">=</span> <span class="m">0</span>
  <span class="n">examineAll</span> <span class="o">=</span> <span class="m">1</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">numChanged</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="o">|</span> <span class="n">examineAll</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">numChanged</span> <span class="o">=</span> <span class="m">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">examineAll</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i0</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1"># loop through all data set
</span>        <span class="n">examA</span> <span class="o">=</span> <span class="n">examineExample</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>   <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="n">numChanged</span> <span class="o">=</span> <span class="n">numChanged</span> <span class="o">+</span> <span class="n">examA</span><span class="o">$</span><span class="n">val</span>
        <span class="c1">#w = examA$w
</span>        <span class="n">alphas</span> <span class="o">=</span> <span class="n">examA</span><span class="o">$</span><span class="n">alphas</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">examA</span><span class="o">$</span><span class="n">error</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">examA</span><span class="o">$</span><span class="n">b</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">examA</span><span class="o">$</span><span class="n">n</span>
      <span class="p">}</span> 
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">unbound</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="n">alphas</span><span class="o">!=</span><span class="m">0</span> <span class="o">&amp;</span> <span class="n">alphas</span><span class="o">!=</span><span class="n">C</span><span class="p">)</span>
      <span class="c1">#unbound = which(alphas&gt;eps &amp; alphas&lt;(C-eps))
</span>      <span class="k">for</span> <span class="p">(</span><span class="n">i0</span> <span class="k">in</span> <span class="n">unbound</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1"># loop through only the unbound data
</span>        <span class="n">examB</span> <span class="o">=</span> <span class="n">examineExample</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>   <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="n">numChanged</span> <span class="o">=</span> <span class="n">numChanged</span> <span class="o">+</span> <span class="n">examB</span><span class="o">$</span><span class="n">val</span>
        <span class="c1">#w = examB$w
</span>        <span class="n">alphas</span> <span class="o">=</span> <span class="n">examB</span><span class="o">$</span><span class="n">alphas</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">examB</span><span class="o">$</span><span class="n">error</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">examB</span><span class="o">$</span><span class="n">b</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">examB</span><span class="o">$</span><span class="n">n</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">examineAll</span> <span class="o">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">examineAll</span> <span class="o">=</span> <span class="m">0</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">numChanged</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">examineAll</span> <span class="o">=</span> <span class="m">1</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
  <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<h2 id="smo-algorithm">SMO Algorithm</h2>

<p><a href="http://en.wikipedia.org/wiki/Sequential_minimal_optimization">SMO</a> is an algotirhm for solving quadratic programming problem.</p>

<p>I Still working on a mathematic explanation for my SMO code.</p>

<h2 id="application">Application</h2>

<h3 id="linear-seperator">Linear Seperator</h3>

<p>Here is the plot of data.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">require</span><span class="p">(</span><span class="n">R.matlab</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">readMat</span><span class="p">(</span><span class="s1">'ex6data1.mat'</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">$</span><span class="n">X</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="o">$</span><span class="n">y</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">Y</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">Y</span><span class="o">==</span><span class="m">-1</span><span class="p">,]</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">Y</span><span class="o">==</span><span class="m">1</span><span class="p">,]</span>
<span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">pch</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="m">1</span><span class="p">]),</span><span class="n">ylim</span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="m">2</span><span class="p">]))</span>
<span class="n">points</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">pch</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/source/2014-12-16-Support-Vector-Machine/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" /></p>

<p>We can find that there is a outlier in red points at top left corner. Should we consider this outlier or no? SVM is able to deal with this kind of situation.</p>

<p>With different $C$, SVM will find different hyperplane to seperate the data:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">X1</span> <span class="o">=</span> <span class="n">data1</span><span class="o">$</span><span class="n">X</span>
<span class="n">Y1</span> <span class="o">=</span> <span class="n">data1</span><span class="o">$</span><span class="n">y</span>
<span class="n">Y1</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">Y1</span><span class="p">,</span><span class="n">Y1</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span>

<span class="n">K1</span> <span class="o">=</span> <span class="n">kernal_linear</span><span class="p">(</span><span class="n">X1</span><span class="p">)</span>

<span class="n">test1</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span><span class="n">Y1</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="m">1000</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="m">0.01</span><span class="p">)</span>
<span class="n">alphas1</span><span class="o">=</span><span class="n">test1</span><span class="o">$</span><span class="n">alphas</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">test1</span><span class="o">$</span><span class="n">b</span>
<span class="n">w1</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">alphas1</span><span class="o">*</span><span class="n">Y1</span><span class="p">)</span><span class="o">%*%</span><span class="n">X1</span>

<span class="n">linearplot</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="n">Y1</span><span class="p">,</span><span class="n">w1</span><span class="p">,</span><span class="n">b1</span><span class="p">,</span><span class="n">main</span><span class="o">=</span><span class="s2">"C=1000"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/source/2014-12-16-Support-Vector-Machine/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">X1</span> <span class="o">=</span> <span class="n">data1</span><span class="o">$</span><span class="n">X</span>
<span class="n">Y1</span> <span class="o">=</span> <span class="n">data1</span><span class="o">$</span><span class="n">y</span>
<span class="n">Y1</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">Y1</span><span class="p">,</span><span class="n">Y1</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span>

<span class="n">K1</span> <span class="o">=</span> <span class="n">kernal_linear</span><span class="p">(</span><span class="n">X1</span><span class="p">)</span>

<span class="n">test1</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span><span class="n">Y1</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="m">0.01</span><span class="p">)</span>
<span class="n">alphas1</span><span class="o">=</span><span class="n">test1</span><span class="o">$</span><span class="n">alphas</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">test1</span><span class="o">$</span><span class="n">b</span>
<span class="n">w1</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">alphas1</span><span class="o">*</span><span class="n">Y1</span><span class="p">)</span><span class="o">%*%</span><span class="n">X1</span>

<span class="n">linearplot</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="n">Y1</span><span class="p">,</span><span class="n">w1</span><span class="p">,</span><span class="n">b1</span><span class="p">,</span><span class="n">main</span><span class="o">=</span><span class="s2">"C=1"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/source/2014-12-16-Support-Vector-Machine/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /></p>

<h3 id="non-linear-seperator">Non-linear Seperator</h3>

<p><a href="http://en.wikipedia.org/wiki/Radial_basis_function_kernel">Radial basis function kernel</a> (RBF) has been used for non-linear seperator.</p>

<p>Here is the data</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">data2</span> <span class="o">=</span> <span class="n">readMat</span><span class="p">(</span><span class="s1">'ex6data2.mat'</span><span class="p">)</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">data2</span><span class="o">$</span><span class="n">X</span>
<span class="n">Y2</span> <span class="o">=</span> <span class="n">data2</span><span class="o">$</span><span class="n">y</span>
<span class="n">Y2</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">Y2</span><span class="p">,</span><span class="n">Y2</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="p">(</span><span class="m">3</span><span class="o">+</span><span class="n">Y2</span><span class="p">),</span><span class="n">xlim</span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="n">X2</span><span class="p">[,</span><span class="m">1</span><span class="p">]),</span><span class="n">ylim</span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="n">X2</span><span class="p">[,</span><span class="m">2</span><span class="p">]),</span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/source/2014-12-16-Support-Vector-Machine/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" /></p>

<p>Train the data set with different $C$ and $\sigma$</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">data2</span> <span class="o">=</span> <span class="n">readMat</span><span class="p">(</span><span class="s1">'ex6data2.mat'</span><span class="p">)</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">data2</span><span class="o">$</span><span class="n">X</span>
<span class="n">Y2</span> <span class="o">=</span> <span class="n">data2</span><span class="o">$</span><span class="n">y</span>
<span class="n">Y2</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">Y2</span><span class="p">,</span><span class="n">Y2</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span>
<span class="n">K1</span> <span class="o">=</span> <span class="n">kernal_RBF</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="m">0.1</span><span class="p">)</span>
<span class="n">test1</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">K2</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span><span class="n">Y2</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="m">0.1</span><span class="p">)</span>
<span class="n">K2</span> <span class="o">=</span> <span class="n">kernal_RBF</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="m">0.029</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">K2</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span><span class="n">Y2</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="m">100</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="m">0.1</span><span class="p">)</span></code></pre></figure>

<p>Here is the function to visulize the training result</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Predict</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">svalpha</span><span class="p">,</span><span class="n">svX</span><span class="p">,</span><span class="n">svY</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="m">0.1</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">#   indx = alpha&gt;0
</span>  <span class="n">x1</span> <span class="o">=</span> <span class="n">rowSums</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
  <span class="n">sv1</span> <span class="o">=</span> <span class="n">rowSums</span><span class="p">(</span><span class="n">svX</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="m">-2</span><span class="o">*</span><span class="n">x</span><span class="o">%*%</span><span class="n">t</span><span class="p">(</span><span class="n">svX</span><span class="p">)</span>
  <span class="n">k1</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="n">z</span><span class="o">+</span><span class="n">sv1</span><span class="p">)</span>
  <span class="n">k</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">k1</span><span class="p">),</span><span class="m">2</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="n">z</span><span class="o">+</span><span class="n">x1</span><span class="p">)</span>
  <span class="n">k</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">^</span><span class="m">2</span><span class="p">))</span>
  <span class="n">k1</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="n">z</span><span class="o">*</span><span class="n">svY</span><span class="p">)</span>
  <span class="n">k2</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">k1</span><span class="p">),</span><span class="m">1</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="n">z</span><span class="o">*</span><span class="n">svalpha</span><span class="p">)</span>
  <span class="n">K</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
  <span class="n">K</span> <span class="o">=</span> <span class="n">rowSums</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
  <span class="n">K</span><span class="p">[</span><span class="n">K</span><span class="o">&gt;=</span><span class="m">0</span><span class="p">]</span> <span class="o">=</span> <span class="m">1</span>
  <span class="n">K</span><span class="p">[</span><span class="n">K</span><span class="o">&lt;</span><span class="m">0</span><span class="p">]</span> <span class="o">=</span><span class="m">-1</span>
  <span class="k">return</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">gen_space</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="m">0.1</span><span class="p">){</span>
  <span class="n">idx</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">&gt;</span><span class="m">0</span>
  <span class="n">x1plot</span> <span class="o">=</span> <span class="n">seq</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">1</span><span class="p">]),</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">1</span><span class="p">]),(</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="o">-</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">1</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="n">l</span><span class="m">-1</span><span class="p">))</span>
  <span class="n">x2plot</span> <span class="o">=</span> <span class="n">seq</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="p">]),</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="p">]),(</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span><span class="o">-</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="n">l</span><span class="m">-1</span><span class="p">))</span>
  <span class="n">xx1</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">rep</span><span class="p">(</span><span class="n">x1plot</span><span class="p">,</span><span class="n">l</span><span class="p">),</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">))</span>
  <span class="n">xx2</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">rep</span><span class="p">(</span><span class="n">x2plot</span><span class="p">,</span><span class="n">l</span><span class="p">),</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
  
  <span class="n">svX2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,]</span>
  <span class="n">svY2</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">idx</span><span class="p">,]</span>
  <span class="n">svalphas2</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">[</span><span class="n">idx2</span><span class="p">,]</span>
  <span class="n">vals</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">xx1</span><span class="p">),</span><span class="n">ncol</span><span class="p">(</span><span class="n">xx2</span><span class="p">))</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">xx1</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">cbind</span><span class="p">(</span><span class="n">xx1</span><span class="p">[,</span><span class="n">i</span><span class="p">],</span><span class="n">xx2</span><span class="p">[,</span><span class="n">i</span><span class="p">])</span>
    <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span> <span class="o">=</span> <span class="n">Predict</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">svalphas2</span><span class="p">,</span><span class="n">svX2</span><span class="p">,</span><span class="n">svY2</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x1plot</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">x2plot</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="n">vals</span><span class="p">))</span>
<span class="c1">#   contour(x1plot,x2plot,vals,nlevels=nlevel,lty=lty)
</span><span class="p">}</span></code></pre></figure>

<p>Visualize the two hyperplanes</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">alphas2</span> <span class="o">=</span> <span class="n">read.table</span><span class="p">(</span><span class="s2">"s0.1c1"</span><span class="p">)</span>
<span class="n">space</span> <span class="o">=</span> <span class="n">gen_space</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="n">Y2</span><span class="p">,</span><span class="n">alphas2</span><span class="p">,</span><span class="m">100</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="p">(</span><span class="m">3</span><span class="o">+</span><span class="n">Y2</span><span class="p">),</span><span class="n">xlim</span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="n">X2</span><span class="p">[,</span><span class="m">1</span><span class="p">]),</span><span class="n">ylim</span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="n">X2</span><span class="p">[,</span><span class="m">2</span><span class="p">]),</span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">main</span><span class="o">=</span><span class="s2">"Non-linear seperator"</span><span class="p">)</span>
<span class="n">contour</span><span class="p">(</span><span class="n">space</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="n">space</span><span class="o">$</span><span class="n">y</span><span class="p">,</span><span class="n">space</span><span class="o">$</span><span class="n">z</span><span class="p">,</span><span class="n">nlevels</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="s2">"sigma0.1 C1"</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="n">read.table</span><span class="p">(</span><span class="s2">"s0.029c100"</span><span class="p">)</span>
<span class="n">space1</span> <span class="o">=</span> <span class="n">gen_space</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span><span class="n">Y2</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="m">0.029</span><span class="p">)</span>
<span class="n">contour</span><span class="p">(</span><span class="n">space1</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="n">space1</span><span class="o">$</span><span class="n">y</span><span class="p">,</span><span class="n">space1</span><span class="o">$</span><span class="n">z</span><span class="p">,</span><span class="n">nlevels</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="s2">"sigma0.029 C100"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/source/2014-12-16-Support-Vector-Machine/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<h1 id="refference">Refference</h1>

<ul>
  <li>Learning with Kernels: Support Vector Machines, Regularization, Optimization, and Beyond</li>
  <li>The Elements of Statistical Learning, Data Mining, Inference, and Prediction</li>
  <li>Sequential Minimal Optimization: A Fast Algorithm for Training Support Vector Machines, 1998, John C. Platt</li>
  <li>Coursera <a href="https://class.coursera.org/ml-006">Stanford University Machine Learning</a> online course</li>
  <li>Edx <a href="https://courses.edx.org/courses/CaltechX/CS_1156x/3T2014/info">Learning From Data</a> online course</li>
  <li><a href="http://blog.pluskid.org/?page_id=683">Free Mind Blog</a></li>
</ul>
</p>
	
      </li>
    
      <li>
        <span class="post-meta">Dec 2, 2014</span>

        <h2>
          <a class="post-link" href="/2014/12/NN.html">Digit Recognizer by Neural Network</a>
        </h2>
	<hr style="color:#EEEEFF" />
	<p><h2 id="intorduction">Intorduction</h2>
<p>This algorithm is for a <a href="https://www.kaggle.com/c/digit-recognizer">kaggle competition</a> to take an image of a handwritten single digit, and determine what that digit is. The data used is <a href="https://www.kaggle.com/c/digit-recognizer/data">MNIST data</a>.</p>

<p>The data include 42000 image of hand-drawn digits. Each image is 28 pixels in height and 28 pixels in width, for a total of 784 pixels.</p>

<p>Let’s visualize some sample data:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">require</span><span class="p">(</span><span class="n">graphics</span><span class="p">)</span>

<span class="n">flip</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">xx</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">ncol</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">x</span><span class="p">))){</span>
    <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span> <span class="o">=</span> <span class="n">rev</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,])}</span>
  <span class="k">return</span><span class="p">(</span><span class="n">xx</span><span class="p">)}</span>

<span class="n">sample_plot</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">list</span><span class="p">()</span>
  <span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span><span class="n">mar</span><span class="o">=</span><span class="n">rep</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="m">4</span><span class="p">))</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="m">28</span><span class="p">,</span><span class="m">28</span><span class="p">)</span>
    <span class="n">xx</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">flip</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    <span class="n">image</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">xx</span><span class="p">[[</span><span class="n">i</span><span class="p">]],</span> <span class="n">col</span><span class="o">=</span><span class="n">gray.colors</span><span class="p">(</span><span class="m">12</span><span class="p">),</span><span class="n">xaxt</span><span class="o">=</span><span class="s1">'n'</span><span class="p">,</span><span class="n">yaxt</span><span class="o">=</span><span class="s1">'n'</span><span class="p">,</span><span class="n">ann</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
  <span class="p">}}</span>

<span class="n">sample_p</span> <span class="o">&lt;-</span> <span class="n">read.csv</span><span class="p">(</span><span class="s2">"sample.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)[,</span><span class="m">-1</span><span class="p">]</span>
<span class="n">sample_p</span> <span class="o">=</span> <span class="n">sample_p</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span>
<span class="n">sample_plot</span><span class="p">(</span><span class="n">sample_p</span><span class="p">,</span><span class="m">16</span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/source/2014-12-2-NN/unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" /></p>

<h2 id="neural-network-algorithm">Neural Network Algorithm</h2>

<h3 id="forward-propagation">Forward Propagation</h3>

<p>The model used is one level Artifical Neural Network(ANN). The superscript number in brack of each variable represent the level. In this model(one level ANN), 0 represent input level, 1 represent hidden level, 2 represent output level. $X^{(0)}$ is the raw data(a image of hand-drawn digit), a 1 row 784 columns matrix. $f_{\theta}(a)$ is a sigmoid function。$a$ hidden level variables，$z$ is the hidden level data and the output of sigmoid function ,$\Theta^{(l)}_0$ are the biased terms in input level and output level. $\widehat{Y}$ is the output and predicted values，a 1 row 10 columns matrix range between 0 and 1. When the maximum value lie in the third column, the prediction of the image would be 3.</p>

<script type="math/tex; mode=display">a^{(1)} = \Theta^{(1)}_0+X^{(0)}(\Theta^{(1)})^T</script>

<script type="math/tex; mode=display">z^{(1)} = f_{\theta}(a^{(1)})</script>

<script type="math/tex; mode=display">a^{(2)} = \Theta^{(2)}_0+z^{(1)}(\Theta^{(2)})^T</script>

<script type="math/tex; mode=display">\hat{Y} = f_{\theta}(a^{(2)})</script>

<p>Here is structure of one hidden layer  Neural Network(with 15 unit in the hidden layer):</p>

<p><img src="/figure/source/2014-12-2-NN/tikz12.png" alt="NN graph" /></p>

<h3 id="cost-function">Cost Function</h3>

<p>For classification problem, we use Cross-entropy cost function:</p>

<script type="math/tex; mode=display">J(\Theta)= -\frac{1}{2}  \left[  \sum^m_i \sum^{10}_k y^{(i)}_{k}log f_\theta (a^{(i)})_{k}  
  + (1-y^{(i)}_k ) log( 1- f_\theta (a^{(i)})_{k} )  \right]</script>

<p>or the simple version:</p>

<script type="math/tex; mode=display">J(\Theta)= -\frac{1}{m} \sum^m_i \sum^{10}_k y^{(i)}_{k}log f_\theta (a^{(i)})_{k}</script>

<h3 id="back-propagation">Back Propagation</h3>

<p>From the cost function $J(\Theta)$, we have the derivatives of $\Theta^{(1)}$ and $\Theta^{(2)}$:</p>

<script type="math/tex; mode=display">\frac{\partial J(\Theta)}{\partial \Theta^{(2)}} =  \frac{\partial f_{\theta}(a^{(2)})}{\partial a^{(2)}} \frac{\partial a^{(2)}}{\partial \Theta^{(2)}}</script>

<script type="math/tex; mode=display">\frac{\partial J(\Theta)}{\partial \Theta^{(2)}} =  (y-f_{\theta}(a^{(2)}))^Tz^{(1)}</script>

<script type="math/tex; mode=display">\frac{\partial J(\Theta)}{\partial \Theta^{(1)}} =  \frac{\partial f_{\theta}(a^{(2)})}{\partial a^{(2)}} \frac{\partial a^{(2)}}{\partial \Theta^{(2)}} \frac{\partial f_{\theta}(a^{(1)})}{\partial a^{(1)}} \frac{\partial a^{(1)}}{\partial \Theta^{(1)}}</script>

<script type="math/tex; mode=display">\frac{\partial J(\Theta)}{\partial \Theta^{(1)}} = \frac{\partial J(\Theta)}{\partial \Theta^{(2)}} \frac{\partial f_{\theta}(a^{(1)})}{\partial a^{(1)}} X^{(0)}</script>

<p>Here is the R code for the neural network. This model include 25 units in the hidden layer. $J(\Theta)$ can be minimize by gradient descent, called back-propagation in the setting.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">NN_cost</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">h_layer</span><span class="o">=</span><span class="m">25</span><span class="p">,</span> <span class="n">lambda</span><span class="o">=</span><span class="m">0</span><span class="p">,</span> <span class="n">num_labels</span><span class="o">=</span><span class="m">10</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="n">m</span> <span class="o">=</span> <span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="c1"># reshape Theta1 and Theta2
</span>  <span class="n">in_layer</span> <span class="o">=</span> <span class="n">ncol</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">par_t1</span> <span class="o">=</span> <span class="n">init</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="p">((</span><span class="n">in_layer</span><span class="m">+1</span><span class="p">)</span><span class="o">*</span><span class="n">h_layer</span><span class="p">))]</span>

  <span class="n">par_t2</span> <span class="o">=</span> <span class="n">init</span><span class="p">[</span><span class="n">c</span><span class="p">(((</span><span class="n">in_layer</span><span class="m">+1</span><span class="p">)</span><span class="o">*</span><span class="n">h_layer</span><span class="m">+1</span><span class="p">)</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">init</span><span class="p">))]</span>
  <span class="n">Theta1</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">par_t1</span><span class="p">,</span><span class="n">h_layer</span><span class="p">,</span><span class="n">in_layer</span><span class="m">+1</span><span class="p">)</span>
  <span class="n">Theta2</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">par_t2</span><span class="p">,</span><span class="n">num_labels</span><span class="p">,</span><span class="n">h_layer</span><span class="m">+1</span><span class="p">)</span>
  
  
  <span class="n">a1</span> <span class="o">=</span> <span class="n">cbind</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
  <span class="n">z2</span> <span class="o">=</span> <span class="n">a1</span><span class="o">%*%</span><span class="n">t</span><span class="p">(</span><span class="n">Theta1</span><span class="p">)</span>
  <span class="n">a2</span> <span class="o">=</span> <span class="n">cbind</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">z2</span><span class="p">))</span>
  <span class="n">z3</span> <span class="o">=</span> <span class="n">a2</span><span class="o">%*%</span><span class="n">t</span><span class="p">(</span><span class="n">Theta2</span><span class="p">)</span>
  <span class="n">h</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">z3</span><span class="p">)</span>
  
  <span class="n">ny</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">num_labels</span><span class="p">)</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">y</span><span class="p">)){</span>
    <span class="n">ny</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="m">1</span>
  <span class="p">}</span>
  
  <span class="n">regu</span> <span class="o">=</span> <span class="n">lambda</span><span class="o">*</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="n">Theta1</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">+</span><span class="n">sum</span><span class="p">(</span><span class="n">Theta2</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span><span class="o">^</span><span class="m">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">m</span><span class="p">)</span>
  <span class="n">cost</span> <span class="o">=</span> <span class="o">-</span><span class="n">sum</span><span class="p">(</span><span class="n">ny</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">ny</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">h</span><span class="p">))</span><span class="o">/</span><span class="n">m</span><span class="o">+</span><span class="n">regu</span>
  
  <span class="n">delta3</span> <span class="o">=</span> <span class="n">h</span><span class="o">-</span><span class="n">ny</span>
  <span class="n">delta2</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta3</span><span class="o">%*%</span><span class="n">Theta2</span><span class="p">[,</span><span class="m">-1</span><span class="p">])</span><span class="o">*</span><span class="n">sigmoidGradient</span><span class="p">(</span><span class="n">z2</span><span class="p">)</span>
  
  <span class="n">thres1</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">Theta1</span><span class="p">),</span><span class="n">ncol</span><span class="p">(</span><span class="n">Theta1</span><span class="p">))</span>
  <span class="n">thres1</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="o">=</span> <span class="m">0</span>
  <span class="n">thres2</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">(</span><span class="n">Theta2</span><span class="p">),</span><span class="n">ncol</span><span class="p">(</span><span class="n">Theta2</span><span class="p">))</span>
  <span class="n">thres2</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="o">=</span> <span class="m">0</span>
  
  <span class="n">Theta1_grad</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">delta2</span><span class="p">)</span><span class="o">%*%</span><span class="n">a1</span><span class="p">)</span><span class="o">/</span><span class="n">m</span> <span class="o">+</span> <span class="n">thres1</span><span class="o">*</span><span class="n">Theta1</span><span class="o">*</span><span class="n">lambda</span><span class="o">/</span><span class="n">m</span>
  <span class="n">Theta2_grad</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">delta3</span><span class="p">)</span><span class="o">%*%</span><span class="n">a2</span><span class="p">)</span><span class="o">/</span><span class="n">m</span> <span class="o">+</span> <span class="n">thres2</span><span class="o">*</span><span class="n">Theta2</span><span class="o">*</span><span class="n">lambda</span><span class="o">/</span><span class="n">m</span>
  
  <span class="n">result</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="n">cost</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span><span class="n">grad</span><span class="o">=</span><span class="n">list</span><span class="p">(</span><span class="n">t1</span><span class="o">=</span><span class="n">Theta1_grad</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">Theta2_grad</span><span class="p">))</span>
  <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<h2 id="train-the-model">Train The Model</h2>

<p>First, we randomly select 70% of data as training data set.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">data_all</span> <span class="o">&lt;-</span> <span class="n">read.csv</span><span class="p">(</span><span class="s2">"train.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="m">0.7</span><span class="o">*</span><span class="n">nrow</span><span class="p">(</span><span class="n">data_all</span><span class="p">))</span>
<span class="n">train_indx</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">seq_len</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">data_all</span><span class="p">)),</span> <span class="n">size</span> <span class="o">=</span> <span class="n">train_size</span><span class="p">)</span></code></pre></figure>

<p>Preprocess and normalize data.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">data</span> <span class="o">=</span> <span class="n">data_all</span><span class="p">[</span><span class="n">train_indx</span><span class="p">,]</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">data.matrix</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">$</span><span class="n">label</span>
<span class="n">y</span><span class="o">=</span><span class="n">replace</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">)</span>
<span class="n">train_nl</span> <span class="o">=</span> <span class="p">(</span><span class="n">train</span><span class="m">-125</span><span class="p">)</span><span class="o">/</span><span class="m">255</span></code></pre></figure>

<p>Build up the initial value and training variables.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">h_layer</span><span class="o">=</span><span class="m">25</span>
<span class="n">t1_epsilon</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="m">6</span><span class="p">)</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ncol</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">+</span><span class="n">h_layer</span><span class="p">)</span>
<span class="n">t2_epsilon</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="m">6</span><span class="p">)</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">h_layer</span><span class="m">+10</span><span class="p">)</span>
<span class="n">t1_random</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">runif</span><span class="p">((</span><span class="n">ncol</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="m">+1</span><span class="p">)</span><span class="o">*</span><span class="m">25</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="m">25</span><span class="p">,(</span><span class="n">ncol</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="m">+1</span><span class="p">))</span>
<span class="n">t2_random</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">26</span><span class="o">*</span><span class="m">10</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="m">10</span><span class="p">,</span><span class="m">26</span><span class="p">)</span>
<span class="n">t1_random</span> <span class="o">=</span> <span class="n">t1_random</span><span class="o">*</span><span class="m">2</span><span class="o">*</span><span class="n">t1_epsilon</span> <span class="o">-</span> <span class="n">t1_epsilon</span>
<span class="n">t2_random</span> <span class="o">=</span> <span class="n">t2_random</span><span class="o">*</span><span class="m">2</span><span class="o">*</span><span class="n">t2_epsilon</span> <span class="o">-</span> <span class="n">t2_epsilon</span>
<span class="n">ini</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">as.vector</span><span class="p">(</span><span class="n">t1_random</span><span class="p">),</span><span class="n">as.vector</span><span class="p">(</span><span class="n">t2_random</span><span class="p">))</span>
<span class="n">lambda</span><span class="o">=</span><span class="m">1</span>
<span class="n">costFunction</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">NN_cost</span><span class="p">(</span><span class="n">train_nl</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">lambda</span><span class="o">=</span><span class="n">lambda</span><span class="p">)</span>
  <span class="n">J</span> <span class="o">=</span> <span class="n">result</span><span class="o">$</span><span class="n">cost</span>
  <span class="n">grad</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">as.vector</span><span class="p">(</span><span class="n">result</span><span class="o">$</span><span class="n">grad</span><span class="o">$</span><span class="n">t1</span><span class="p">),</span><span class="n">as.vector</span><span class="p">(</span><span class="n">result</span><span class="o">$</span><span class="n">grad</span><span class="o">$</span><span class="n">t2</span><span class="p">))</span>
  <span class="n">grad</span> <span class="o">=</span> <span class="n">as.matrix</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span><span class="n">length</span><span class="p">(</span><span class="n">grad</span><span class="p">),</span><span class="m">1</span><span class="p">)</span>
  <span class="k">return</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">J</span><span class="o">=</span><span class="n">J</span><span class="p">,</span><span class="n">grad</span><span class="o">=</span><span class="n">grad</span><span class="p">))</span>
<span class="p">}</span></code></pre></figure>

<p>Optimize the model</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">optimization</span> <span class="o">=</span> <span class="n">fmincg</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">costFunction</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">par</span><span class="p">,</span> <span class="n">Maxiter</span><span class="o">=</span><span class="m">500</span><span class="p">)</span></code></pre></figure>

<p>At the end, I use $fmincg$ function to do the optimization. Because $fmincg$ function is more efficient than my own gradient decent function. $fmincg$ is one of the optimization function Andrew Ng used in his online course <a href="https://www.coursera.org/course/ml">Machine Learning</a>. This function was original written in Matlab, I rewrite it into R. Here are the R code for $fmincg$ function.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fmincg</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">X</span><span class="p">,</span> <span class="n">Maxiter</span><span class="o">=</span><span class="m">10</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">length</span> <span class="o">=</span> <span class="n">Maxiter</span>
  <span class="n">RHO</span> <span class="o">=</span> <span class="m">0.01</span> 
  <span class="n">SIG</span> <span class="o">=</span> <span class="m">0.5</span>  
  <span class="n">INT</span> <span class="o">=</span> <span class="m">0.1</span>  
  <span class="n">EXT</span> <span class="o">=</span> <span class="m">3.0</span>  
  <span class="n">MAX</span> <span class="o">=</span> <span class="m">20</span>   
  <span class="n">RATIO</span> <span class="o">=</span> <span class="m">100</span>
  <span class="n">red</span> <span class="o">=</span> <span class="m">1</span>
  
  <span class="n">i</span> <span class="o">=</span> <span class="m">0</span>
  <span class="n">ls_failed</span> <span class="o">=</span> <span class="m">0</span>
  <span class="n">fX</span> <span class="o">=</span> <span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
  <span class="n">eval</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">f1</span> <span class="o">=</span> <span class="n">eval</span><span class="o">$</span><span class="n">J</span>
  <span class="n">df1</span> <span class="o">=</span> <span class="n">eval</span><span class="o">$</span><span class="n">grad</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">length</span><span class="o">&lt;</span><span class="m">0</span><span class="p">)</span>
  <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="n">df1</span>
  <span class="n">d1</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">%*%</span><span class="n">s</span>
  <span class="n">z1</span> <span class="o">=</span> <span class="n">red</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span>
  
  <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">abs</span><span class="p">(</span><span class="n">length</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">length</span><span class="o">&gt;</span><span class="m">0</span><span class="p">)</span>
    <span class="n">X0</span> <span class="o">=</span> <span class="n">X</span><span class="p">;</span> <span class="n">f0</span> <span class="o">=</span> <span class="n">f1</span><span class="p">;</span> <span class="n">df0</span> <span class="o">=</span> <span class="n">df1</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">z1</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">*</span><span class="n">s</span>
    <span class="n">eval</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">eval</span><span class="o">$</span><span class="n">J</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">eval</span><span class="o">$</span><span class="n">grad</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">length</span><span class="o">&lt;</span><span class="m">0</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="o">%*%</span><span class="n">s</span><span class="p">;</span>
    <span class="n">f3</span> <span class="o">=</span> <span class="n">f1</span><span class="p">;</span> <span class="n">d3</span> <span class="o">=</span> <span class="n">d1</span><span class="p">;</span> <span class="n">z3</span> <span class="o">=</span> <span class="o">-</span><span class="n">z1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">length</span><span class="o">&gt;</span><span class="m">0</span><span class="p">){</span><span class="n">M</span><span class="o">=</span><span class="n">MAX</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="n">M</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">MAX</span><span class="p">,</span><span class="o">-</span><span class="n">length</span><span class="o">-</span><span class="n">i</span><span class="p">)}</span>
    <span class="n">success</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">limit</span> <span class="o">=</span> <span class="m">-1</span><span class="p">;</span> 
    <span class="k">while</span><span class="p">(</span><span class="m">1</span><span class="p">){</span>
      <span class="k">while</span><span class="p">(((</span><span class="n">f2</span> <span class="o">&gt;</span> <span class="n">f1</span><span class="o">+</span><span class="n">z1</span><span class="o">*</span><span class="n">RHO</span><span class="o">*</span><span class="n">d1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">d2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">SIG</span><span class="o">*</span><span class="n">d1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">M</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="n">z1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">f2</span> <span class="o">&gt;</span> <span class="n">f1</span><span class="p">){</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">z3</span> <span class="o">-</span> <span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">d3</span><span class="o">*</span><span class="n">z3</span><span class="o">*</span><span class="n">z3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">d3</span><span class="o">*</span><span class="n">z3</span><span class="o">+</span><span class="n">f2</span><span class="o">-</span><span class="n">f3</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">A</span> <span class="o">=</span> <span class="m">6</span><span class="o">*</span><span class="p">(</span><span class="n">f2</span><span class="o">-</span><span class="n">f3</span><span class="p">)</span><span class="o">/</span><span class="n">z3</span><span class="m">+3</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">+</span><span class="n">d3</span><span class="p">)</span>                                
          <span class="n">B</span> <span class="o">=</span> <span class="m">3</span><span class="o">*</span><span class="p">(</span><span class="n">f3</span><span class="o">-</span><span class="n">f2</span><span class="p">)</span><span class="o">-</span><span class="n">z3</span><span class="o">*</span><span class="p">(</span><span class="n">d3</span><span class="m">+2</span><span class="o">*</span><span class="n">d2</span><span class="p">)</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">d2</span><span class="o">*</span><span class="n">z3</span><span class="o">*</span><span class="n">z3</span><span class="p">)</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="n">A</span><span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is.na</span><span class="p">(</span><span class="n">z2</span><span class="p">)</span><span class="o">|</span><span class="n">is.infinite</span><span class="p">(</span><span class="n">z2</span><span class="p">)){</span><span class="n">z2</span> <span class="o">=</span> <span class="n">z3</span><span class="o">/</span><span class="m">2</span><span class="p">}</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">z2</span><span class="p">,</span> <span class="n">INT</span><span class="o">*</span><span class="n">z3</span><span class="p">),(</span><span class="m">1</span><span class="o">-</span><span class="n">INT</span><span class="p">)</span><span class="o">*</span><span class="n">z3</span><span class="p">)</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="n">z1</span> <span class="o">+</span> <span class="n">z2</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">z2</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">*</span><span class="n">s</span>
        <span class="n">eval</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">eval</span><span class="o">$</span><span class="n">J</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">eval</span><span class="o">$</span><span class="n">grad</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">length</span><span class="o">&lt;</span><span class="m">0</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="o">%*%</span><span class="n">s</span>
        <span class="n">z3</span> <span class="o">=</span> <span class="n">z3</span> <span class="o">-</span> <span class="n">z2</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">f2</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">z1</span><span class="o">*</span><span class="n">RHO</span><span class="o">*</span><span class="n">d1</span><span class="p">)</span> <span class="o">|</span> <span class="n">d2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">SIG</span><span class="o">*</span><span class="n">d1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">d2</span> <span class="o">&gt;</span> <span class="n">SIG</span><span class="o">*</span><span class="n">d1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">success</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span> <span class="k">break</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">M</span> <span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span>
      <span class="p">}</span>
      <span class="n">A</span> <span class="o">=</span> <span class="m">6</span><span class="o">*</span><span class="p">(</span><span class="n">f2</span><span class="o">-</span><span class="n">f3</span><span class="p">)</span><span class="o">/</span><span class="n">z3</span><span class="m">+3</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">+</span><span class="n">d3</span><span class="p">)</span>
      <span class="n">B</span> <span class="o">=</span> <span class="m">3</span><span class="o">*</span><span class="p">(</span><span class="n">f3</span><span class="o">-</span><span class="n">f2</span><span class="p">)</span><span class="o">-</span><span class="n">z3</span><span class="o">*</span><span class="p">(</span><span class="n">d3</span><span class="m">+2</span><span class="o">*</span><span class="n">d2</span><span class="p">)</span>
      <span class="n">z2</span> <span class="o">=</span> <span class="o">-</span><span class="n">d2</span><span class="o">*</span><span class="n">z3</span><span class="o">*</span><span class="n">z3</span><span class="o">/</span><span class="p">(</span><span class="n">B</span><span class="o">+</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">d2</span><span class="o">*</span><span class="n">z3</span><span class="o">*</span><span class="n">z3</span><span class="p">))</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">is.na</span><span class="p">(</span><span class="n">z2</span><span class="p">)</span><span class="o">|</span><span class="n">is.infinite</span><span class="p">(</span><span class="n">z2</span><span class="p">)</span><span class="o">|</span><span class="n">z2</span><span class="o">&lt;</span><span class="m">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">limit</span> <span class="o">&lt;</span><span class="m">-0.5</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="n">z1</span><span class="o">*</span><span class="p">(</span><span class="n">EXT</span><span class="m">-1</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">z2</span> <span class="o">=</span> <span class="p">(</span><span class="n">limit</span><span class="o">-</span><span class="n">z1</span><span class="p">)</span><span class="o">/</span><span class="m">2</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">limit</span> <span class="o">&gt;</span> <span class="m">-0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">z2</span><span class="o">+</span><span class="n">z1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">)){</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="p">(</span><span class="n">limit</span><span class="o">-</span><span class="n">z1</span><span class="p">)</span><span class="o">/</span><span class="m">2</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">limit</span> <span class="o">&lt;</span> <span class="m">-0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">z2</span><span class="o">+</span><span class="n">z1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z1</span><span class="o">*</span><span class="n">EXT</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="n">z1</span><span class="o">*</span><span class="p">(</span><span class="n">EXT</span><span class="m">-1</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">z2</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="n">z3</span><span class="o">*</span><span class="n">INT</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="o">-</span><span class="n">z3</span><span class="o">*</span><span class="n">INT</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">limit</span> <span class="o">&gt;</span> <span class="m">-0.5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">z2</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">limit</span><span class="o">-</span><span class="n">z1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">1.0</span><span class="o">-</span><span class="n">INT</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="n">z1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="m">1</span> <span class="o">-</span> <span class="n">INT</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="n">f3</span> <span class="o">=</span> <span class="n">f2</span><span class="p">;</span> <span class="n">d3</span> <span class="o">=</span> <span class="n">d2</span><span class="p">;</span> <span class="n">z3</span> <span class="o">=</span> <span class="o">-</span><span class="n">z2</span><span class="p">;</span> 
      <span class="n">z1</span> <span class="o">=</span> <span class="n">z1</span> <span class="o">+</span> <span class="n">z2</span><span class="p">;</span> <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">z2</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">;</span>
      <span class="n">eval</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
      <span class="n">f2</span> <span class="o">=</span> <span class="n">eval</span><span class="o">$</span><span class="n">J</span>
      <span class="n">df2</span> <span class="o">=</span> <span class="n">eval</span><span class="o">$</span><span class="n">grad</span>
      <span class="n">M</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">length</span><span class="o">&lt;</span><span class="m">0</span><span class="p">)</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="o">%*%</span><span class="n">s</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">f1</span> <span class="o">=</span> <span class="n">f2</span><span class="p">;</span> <span class="n">fX</span> <span class="o">=</span> <span class="n">rbind</span><span class="p">(</span><span class="n">fX</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
      <span class="n">print</span><span class="p">(</span><span class="n">cat</span><span class="p">(</span><span class="s1">'Iteration  '</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">'| Cost:'</span><span class="p">,</span><span class="n">f1</span><span class="p">))</span>
      <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="o">%*%</span><span class="n">df2</span><span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="o">%*%</span><span class="n">df2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="o">%*%</span><span class="n">df1</span><span class="p">)</span>
      <span class="n">s</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">*</span><span class="n">s</span> <span class="o">-</span> <span class="n">df2</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="n">df1</span><span class="p">;</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">df2</span><span class="p">;</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
      <span class="n">d2</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="o">%*%</span><span class="n">s</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">d2</span><span class="o">&gt;</span><span class="m">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="n">df1</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">%*%</span><span class="n">s</span>
      <span class="p">}</span>
      <span class="n">z1</span> <span class="o">=</span> <span class="n">z1</span> <span class="o">*</span> <span class="n">min</span><span class="p">(</span><span class="n">RATIO</span><span class="p">,</span> <span class="n">d1</span><span class="o">/</span><span class="p">(</span><span class="n">d2</span><span class="m">-2.2251e-308</span><span class="p">))</span>
      <span class="n">d1</span> <span class="o">=</span> <span class="n">d2</span>
      <span class="n">ls_failed</span> <span class="o">=</span> <span class="m">0</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">X</span> <span class="o">=</span> <span class="n">X0</span><span class="p">;</span> <span class="n">f1</span> <span class="o">=</span> <span class="n">f0</span><span class="p">;</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">df0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ls_failed</span><span class="o">|</span><span class="n">i</span> <span class="o">&gt;</span> <span class="n">abs</span><span class="p">(</span><span class="n">length</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">break</span>
      <span class="p">}</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="n">df1</span><span class="p">;</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">df2</span><span class="p">;</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
      <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="n">df1</span>
      <span class="n">d1</span> <span class="o">=</span> <span class="o">-</span><span class="n">t</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">%*%</span><span class="n">s</span>
      <span class="n">z1</span> <span class="o">=</span> <span class="m">1</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span>
      <span class="n">ls_failed</span> <span class="o">=</span> <span class="m">1</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">cost</span><span class="o">=</span><span class="n">fX</span><span class="p">))</span>
<span class="p">}</span></code></pre></figure>

<h2 id="training-result">Training Result</h2>

<p>The result is achieve by training this model with 29400 data in 200000 iteration.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">first_try</span> <span class="o">=</span> <span class="n">fmincg</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">costFunction</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">ini</span><span class="p">,</span> <span class="n">Maxiter</span><span class="o">=</span><span class="m">200000</span><span class="p">)</span></code></pre></figure>

<p>$ckeck_accurate$ function is build up to check the accurate of my model ues testing data set and validation data set.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">check_accurate</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">h_layer</span><span class="o">=</span><span class="m">25</span><span class="p">,</span><span class="n">lambda</span><span class="p">,</span><span class="n">num_labels</span><span class="o">=</span><span class="m">10</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">fit_model</span> <span class="o">=</span> <span class="n">NN_cost</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">init</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">h_layer</span><span class="p">,</span><span class="n">lambda</span><span class="o">=</span><span class="n">lambda</span><span class="p">,</span><span class="n">num_labels</span><span class="p">)</span>
  <span class="n">fit_matirx</span> <span class="o">=</span> <span class="n">fit_model</span><span class="o">$</span><span class="n">h</span>
  <span class="n">fit_values</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">fit_matirx</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">which.max</span><span class="p">)</span>
  <span class="n">fit_values</span> <span class="o">=</span> <span class="n">as.vector</span><span class="p">(</span><span class="n">fit_values</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">as.vector</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
  <span class="n">accurate</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">fit_values</span><span class="o">==</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">fit</span> <span class="o">=</span> <span class="n">fit_values</span><span class="p">,</span> <span class="n">acu</span> <span class="o">=</span> <span class="n">accurate</span><span class="p">)</span>
  <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>The rest of the data is been seperate as test set and validate set</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">test_valid_data</span> <span class="o">=</span> <span class="n">data_all</span><span class="p">[</span><span class="o">-</span><span class="n">train_indx</span><span class="p">,]</span>
<span class="n">test_size</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="m">0.7</span><span class="o">*</span><span class="n">nrow</span><span class="p">(</span><span class="n">test_valid_data</span><span class="p">))</span>
<span class="n">test_ind</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">seq_len</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">test_valid_data</span><span class="p">)),</span> <span class="n">size</span> <span class="o">=</span> <span class="n">test_size</span><span class="p">)</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">test_valid_data</span><span class="p">[</span><span class="n">test_ind</span><span class="p">,]</span>
<span class="n">valid_data</span> <span class="o">=</span> <span class="n">test_valid_data</span><span class="p">[</span><span class="o">-</span><span class="n">test_ind</span><span class="p">,]</span></code></pre></figure>

<p>Setting up the test set and ckeck the accurate.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[,</span><span class="m">-1</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">data.matrix</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">test_y</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">$</span><span class="n">label</span>
<span class="n">test_y</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span><span class="n">test_y</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">)</span>
<span class="n">test_nl</span> <span class="o">=</span> <span class="p">(</span><span class="n">test</span><span class="m">-125</span><span class="p">)</span><span class="o">/</span><span class="m">255</span>

<span class="n">test_accurate</span> <span class="o">=</span> <span class="n">check_accurate</span><span class="p">(</span><span class="n">test_nl</span><span class="p">,</span><span class="n">test_y</span><span class="p">,</span><span class="n">par</span><span class="p">,</span><span class="n">lambda</span><span class="o">=</span><span class="n">lambda</span><span class="p">)</span>
<span class="n">test_accurate</span><span class="o">$</span><span class="n">acu</span></code></pre></figure>

<h2 id="refference">Refference</h2>
<ul>
  <li><a href="https://www.coursera.org/course/ml">Stanford University Machine Learning online course</a></li>
  <li>The Elements of Statistical Learning, Data Mining, Inference, and Prediction</li>
  <li>Machine Learning An Algorithmic Perspective</li>
  <li>Neural Networks and Statistical Learning</li>
</ul>

</p>
	
      </li>
    
      <li>
        <span class="post-meta">Sep 28, 2014</span>

        <h2>
          <a class="post-link" href="/2014/09/welcome-to-jekyll.html">Welcome to Jekyll!</a>
        </h2>
	<hr style="color:#EEEEFF" />
	<p><p>You’ll find this post in your <code class="highlighter-rouge">_posts</code> directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run <code class="highlighter-rouge">jekyll serve --watch</code>, which launches a web server and auto-regenerates your site when a file is updated.</p>

<p>To add new posts, simply add a file in the <code class="highlighter-rouge">_posts</code> directory that follows the convention <code class="highlighter-rouge">YYYY-MM-DD-name-of-post.ext</code> and includes the necessary front matter. Take a look at the source for this post to get an idea about how it works.</p>

<p>Jekyll also offers powerful support for code snippets:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">print_hi</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Hi, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
<span class="n">print_hi</span><span class="p">(</span><span class="s1">'Tom'</span><span class="p">)</span>
<span class="c1">#=&gt; prints 'Hi, Tom' to STDOUT.</span></code></pre></figure>

<p>Check out the <a href="http://jekyllrb.com">Jekyll docs</a> for more info on how to get the most out of Jekyll. File all bugs/feature requests at <a href="https://github.com/jekyll/jekyll">Jekyll’s GitHub repo</a>. If you have questions, you can ask them on <a href="https://github.com/jekyll/jekyll-help">Jekyll’s dedicated Help repository</a>.</p>

</p>
	
      </li>
    
  </ul>

  <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>

</div>
<footer class="site-footer">

  <div class="wrapper">

  

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Nothing About Data</li>
          <li><a href="mailto:htt.22@hotmail.com">htt.22@hotmail.com</a></li>
        </ul>

      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/Nothing about data">
              <span class="icon  icon--github">
                <svg viewbox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z" />
                </svg>
              </span>

              <span class="username">Nothing about data</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/Nothing about data">
              <span class="icon  icon--twitter">
                <svg viewbox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z" />
                </svg>
              </span>

              <span class="username">Nothing about data</span>
            </a>
          </li>
          

          

  


        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">This blog power by Github and Jekyll.
The source code of this blog comes from  <a href="https://github.com/yihui/knitr-jekyll"> yihui</a></p>
	
        
      </div>
    </div>

  </div>

</footer>


      </div>
    </div>



  </body>

</html>
